static unsigned char b64[256]={
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,   62,  128,  128,  128,   63,\
  52,   53,   54,   55,   56,   57,   58,   59,   60,   61,  128,  128,  128,    0,  128,  128,\
  128,    0,    1,    2,    3,    4,    5,    6,    7,    8,    9,   10,   11,   12,   13,   14,\
  15,   16,   17,   18,   19,   20,   21,   22,   23,   24,   25,  128,  128,  128,  128,  128,\
  128,   26,   27,   28,   29,   30,   31,   32,   33,   34,   35,   36,   37,   38,   39,   40,\
  41,   42,   43,   44,   45,   46,   47,   48,   49,   50,   51,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
	128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,\
  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128,  128 \
};

char *decode_base64(char *input_string) {
	int i;
	int input_size=strlen(input_string);
	int stop_count=0;
	int c;
	int char_count=0;
	int out_length=0;
	char output[3];
	char input[4];
	char *output_string;

	output_string = (char *) malloc (sizeof(char *) * (strlen(input_string)*3/4));
	
	char_count=0;
	while (char_count < input_size) {
		input[0] = input[1] = input[2] = input[3] = 0;

		for (i=0; i<4; i++) {
			c = *input_string;
			input_string++;
			char_count++;

			if (c == '=') {
				stop_count++;
			}

			if (b64[c] == 0x80) {
				i--;
				continue;
			}
			input[i] = (char)b64[c];
		}
		output[0] = (input[0] << 2) | (input[1] >> 4);
		output[1] = (input[1] << 4) | (input[2] >> 2);
		output[2] = (input[2] << 6) | input[3];
		if (i == 4) {
			for (i=0; i < (3 - stop_count); i++) {
				*output_string = output[i];
				output_string++;
				out_length++;
			}
		}
	}
	*output_string = '\0';
	output_string-=out_length;
	return output_string;
}
